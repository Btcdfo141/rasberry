#!/bin/sh
# Build and run Home Assinstant in Docker.

# Optional: pass in a timezone as first argument
# If not given will attempt to mount /etc/localtime

# Stop on errors
set -e

cd "$(dirname "$0")/.."

docker build -t home-assistant-dev -f virtualization/Docker/Dockerfile.dev .

if [ $# -gt 0 ]
then
  docker run \
    -d \
    --device=/dev/ttyUSB0:/zwaveusbstick:rwm \
    -e "TZ=$1" \
    -v `pwd`:/usr/src/app \
    -v `pwd`/config:/config \
    -p 8123:8123 \
    -t -i home-assistant-dev

else
  docker run \
    -d \
    -v /etc/localtime:/etc/localtime:ro \
    -v `pwd`:/usr/src/app \
    -v `pwd`/config:/config \
    -p 8123:8123 \
    --rm \
    -t -i home-assistant-dev

fi
