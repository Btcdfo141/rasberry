#!/bin/sh
# Resolve all frontend dependencies that the application requires to run.

# Stop on errors
set -e

cd "$(dirname "$0")/.."

echo "Bootstrapping frontend..."

git submodule update
cd homeassistant/components/frontend/www_static/home-assistant-polymer

# Check if npm is installed
if ! command -v npm >/dev/null 2>&1 ; then
    if python -c 'import sys; exit (0 if hasattr(sys, "real_prefix") else 1)' ; then
        # In a virtual environment, attempt npm install
        echo "Installing npm in virtual environment..."
        pip install nodeenv
        nodeenv --python-virtualenv
    else
        echo "npm is required for frontend development."
        exit 1
    fi
fi

# Install node modules
npm install

# Install bower web components. Allow to download the components as root since the user in docker is root.
./node_modules/.bin/bower install --allow-root

npm run setup_js_dev
cd ../../../../..
